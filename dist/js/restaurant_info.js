let restaurant;var newMap;document.addEventListener("DOMContentLoaded",e=>{initMap(),initRevews()});const initMap=()=>{fetchRestaurantFromURL((e,t)=>{e?console.error(e):(self.newMap=L.map("map",{center:[t.latlng.lat,t.latlng.lng],zoom:16,scrollWheelZoom:!1}),L.tileLayer("https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.jpg70?access_token={mapboxToken}",{mapboxToken:"pk.eyJ1IjoiYW1lcmEiLCJhIjoiY2ptNWUxdmQ0MHV1aTNrdDN0M3hta2JuNSJ9.kBhLNxEwdPQcMTcFN3ijUA",maxZoom:18,attribution:'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',id:"mapbox.streets"}).addTo(newMap),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.newMap))})},initRevews=()=>{getFromOffReviewsOS(review.restaurant_id).then(e=>{e.map(e=>{DBHelper.addReview(e)})}).catch(e=>{});document.querySelectorAll(".offline");clearOffReviewsOS()},fetchRestaurantFromURL=e=>{if(self.restaurant)return void e(null,self.restaurant);const t=getParameterByName("id");t?DBHelper.fetchRestaurantById(t,(t,n)=>{self.restaurant=n,n?(fillRestaurantHTML(),e(null,n)):console.error(t)}):(error="No restaurant id in URL",e(error,null))},fillRestaurantHTML=(e=self.restaurant)=>{document.getElementById("restaurant-name").innerHTML=e.name,document.getElementById("restaurant-address").innerHTML=e.address;const t=document.getElementById("restaurant-img");t.className="restaurant-img",t.src=DBHelper.imageUrlForRestaurant(e),t.alt="image for "+e.name,document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),DBHelper.fetchReviewsByRestId(e.id).then(e=>{fillReviewsHTML(e)}).catch(e=>fillReviewsHTML())},fillRestaurantHoursHTML=(e=self.restaurant.operating_hours)=>{const t=document.getElementById("restaurant-hours");for(let n in e){const r=document.createElement("tr"),a=document.createElement("td");a.innerHTML=n,r.appendChild(a);const o=document.createElement("td");o.innerHTML=e[n],r.appendChild(o),t.appendChild(r)}},fillReviewsHTML=(e=self.restaurant.reviews)=>{const t=document.getElementById("reviews-container"),n=document.createElement("h2");if(n.innerHTML="Reviews",t.appendChild(n),!e){const e=document.createElement("p");return e.innerHTML="No reviews yet!",void t.appendChild(e)}const r=document.getElementById("reviews-list");e.forEach(e=>{r.appendChild(createReviewHTML(e))}),t.appendChild(r)},createReviewHTML=e=>{const t=document.createElement("li"),n=document.createElement("p");n.innerHTML=e.name,t.appendChild(n);const r=document.createElement("p");r.innerHTML=new Date(e.createdAt).toDateString(),t.appendChild(r);const a=document.createElement("p");a.innerHTML=`Rating: ${e.rating}`,t.appendChild(a);const o=document.createElement("p");return o.innerHTML=e.comments,t.appendChild(o),t},fillBreadcrumb=(e=self.restaurant)=>{const t=document.getElementById("breadcrumb"),n=document.createElement("li");n.innerHTML=e.name,t.appendChild(n)},getParameterByName=(e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const n=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null},addToScreen=e=>{const t=document.createElement("li");navigator.onLine||(console.log("offline"),t.setAttribute("class","offline"));const n=document.createElement("p");n.innerHTML=e.name,t.appendChild(n);const r=document.createElement("p");r.innerHTML=(new Date).toDateString(),t.appendChild(r);const a=document.createElement("p");a.innerHTML=`Rating: ${e.rating}`,t.appendChild(a);const o=document.createElement("p");o.innerHTML=e.comments,t.appendChild(o),document.getElementById("reviews-list").appendChild(t)},sendReview=()=>{event.preventDefault(),document.getElementById("send-review").disabled=!0;const e=document.getElementById("name").value,t=document.getElementById("rate").value,n=document.getElementById("review").value,r=parseInt(getParameterByName("id"));if(""===e.trim()?document.getElementById("name-error").innerHTML='<p style="color:red"> ! not valid, Enter Your name .</p>':document.getElementById("name-error").innerHTML="",""===n.trim()?document.getElementById("review-error").innerHTML='<p style="color:red"> ! not valid, Enter Your review . </p>':document.getElementById("review-error").innerHTML="",""!==e.trim()&&""!==n.trim()){const a={restaurant_id:r,name:e,rating:t,comments:n,createdAt:(new Date).getTime()};DBHelper.addReview(a),addToScreen(a),document.getElementById("name").value="",document.getElementById("rate").value=1,document.getElementById("review").value=""}document.getElementById("send-review").disabled=!1};